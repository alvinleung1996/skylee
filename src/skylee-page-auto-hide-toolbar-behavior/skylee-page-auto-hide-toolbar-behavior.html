<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<script>
  function SkyleePageAutoHideToolbarBehavior(superClass) {
    return class extends superClass {

      static get properties() { return {
        pageVisibility: {
          type: String,
        },
        _scrollHandlerEnabled: {
          type: Boolean,
          computed: '_computeScrollHandlerEnabled(pageVisibility)',
          observer: '_onScrollHandlerEnabledChanged'
        },
        toolbarHeight: {
          type: Number
        },
        pageScrollY: {
          type: Number,
          value: 0,
          readOnly: true
        },
        scrollYThreshold: {
          type: Number,
          value: 0
        },

        hideToolbar: {
          type: Boolean,
          value: false,
          readOnly: true,
          notify: true
        },
        showToolbarShadow: { // always true
          type: Boolean,
          value: true,
          readOnly: true,
          notify: true
        },


      };}

      static get observers() { return [
        '_onScrollYChanged(_scrollHandlerEnabled, toolbarHeight, pageScrollY, scrollYThreshold)'
      ];}
      
      constructor() {
        super();
        this.__bindedOnScroll = this._onScroll.bind(this);
      }

      _computeScrollHandlerEnabled(pageVisibility) {
        return pageVisibility === 'showing' || pageVisibility === 'shown';
      }

      _onScrollHandlerEnabledChanged(scrollHandlerEnabled) {
        if (scrollHandlerEnabled) window.addEventListener('scroll', this.__bindedOnScroll);
        else window.removeEventListener('scroll', this.__bindedOnScroll);
      }

      _onScroll(evt) {
        this._setPageScrollY(window.pageYOffset);
      }

      _onScrollYChanged(scrollHandlerEnabled, toolbarHeight, pageScrollY, scrollYThreshold) {
        if (scrollHandlerEnabled) {
          let prevScrollY = this.__prevScrollY;
          let prevPrevScrollY = this.__prevPrevScrollY;

          let newScrollY, oldScrollY;
          if (pageScrollY === prevScrollY) {
            newScrollY = prevScrollY;
            oldScrollY = prevPrevScrollY;
          } else {
            newScrollY = pageScrollY;
            oldScrollY = prevScrollY;
            this.__prevPrevScrollY = prevScrollY;
            this.__prevScrollY = pageScrollY;
          }
          newScrollY = newScrollY || 0;
          oldScrollY = oldScrollY || 0;

          let hideToolbar = Number.isInteger(toolbarHeight) && newScrollY > oldScrollY && newScrollY >= toolbarHeight && newScrollY >= scrollYThreshold;
          // let showToolbarShadow = newScrollTop > 0;
          this.setProperties({
            hideToolbar: hideToolbar,
            // showToolbarShadow: showToolbarShadow
          }, true);
        }
      }

    }
  }
  window.Skylee = window.Skylee || {};
  Skylee.SkyleePageAutoHideToolbarBehavior = SkyleePageAutoHideToolbarBehavior;
</script>
